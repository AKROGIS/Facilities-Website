<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>NPS Facilities (Alaska)</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="leaflet-search/leaflet-search.src.css">
    <script type="text/javascript" src="leaflet-search/leaflet-search.src.js"></script>
  </head>

  <body>

    <div id="header">
      <div id="headerText">
        <h1 id="title">Alaska Facilities</h1>
        <h2 id="subtitle">A tool for locating the maintained infrastructure in Alaska's National Parks and Preserves</h2>
      </div>
      <div id="logoArea">
        <div id="organizationText">
          Alaska Region GIS<br/>
          National Park Service<br/>
          U.S. Department of the Interior<br/>
        </div>
        <div id="logo">
          <img src="images/ArrowheadNoBackground.png" height="100%" alt="National Park Service Arrowhead">
        </div>
      </div>
    </div>

    <div id="map"></div>

    <script>
        (function() {
            var s = document.createElement('script');
            s.src = 'npmap/npmap-bootstrap.js';
            document.body.appendChild(s);
        })();




    function setupSearch() {
        var map = NPMap.config.L;
        var controlSearch = new L.Control.Search({
            layer: NPMap.config.overlays[0].L,
            propertyName: "ID",
            zoom: 18,
            text:"FMSS ID",
            initial: false});
        map.addControl( controlSearch );
    }

    function npmapReady() {
        initSearch();   //in modified version of leaflet-search.js
        setupSearch();  //in main.js
    }

    var NPMap = {
        center: {
            lat: 62,
            lng: -152
        },
        div: 'map',
        overlays: [
          {
            cluster: true,
            popup: {
                title: '{{ID}}',
                description: '<p>{{Name}}</p>' +
                '<table>' +
                    '<tr><td class="att_name">Description</td><td>{{Desc}}</td></tr>' +
                    '<tr><td class="att_name">Value</td><td>{{CRV}}</td></tr>' +
                    '<tr><td class="att_name">Def. Maint</td><td>{{DM}}</td></tr>' +
                    '<tr><td class="att_name">Age</td><td>{{Age}}</td></tr>' +
                    '<tr><td class="att_name">Status</td><td>{{Status}}</td></tr>' +
                    '</table>',
                media:[{
                    type:"fmss",
                    id:"Photo_Id"
                }]
            },
            styles: {
              point: {
                  'marker-symbol': 'square'
              }
            },
            tooltip: '{{ID}}',
            type: 'csv',
            url: 'data/facilities.csv'
          }
          ,{
            type:'arcgisserver',
            opacity: 1.0,
            tiled: false,
            minZoom:15,
            url: 'https://akrgis.nps.gov/arcgis/rest/services/AKR_Apps/FMSS_web_service/MapServer'
          }
        ,{
            type: 'arcgisserver',
            opacity: 0.8,
            tiled: true,
            url: 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer',
            minZoom:15,
          }
        ],
        zoom: 5,
        maxZoom: 20
    };

      var photos;
      fetch("/fmss/photos.json")
        .then(response => response.json())
        .then(data => photos = data);

    </script>
  </body>
</html>
